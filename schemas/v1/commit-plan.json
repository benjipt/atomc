{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://atomc.dev/schema/v1/commit-plan.json",
  "type": "object",
  "required": ["schema_version", "plan"],
  "properties": {
    "schema_version": {"const": "v1"},
    "request_id": {"type": "string"},
    "warnings": {
      "type": "array",
      "items": {"$ref": "#/$defs/warning"}
    },
    "input": {"$ref": "#/$defs/input"},
    "plan": {
      "type": "array",
      "minItems": 1,
      "items": {"$ref": "#/$defs/commitUnit"}
    }
  },
  "additionalProperties": true,
  "$defs": {
    "warning": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": {"type": "string"},
        "message": {"type": "string"},
        "details": {"type": "object"}
      },
      "additionalProperties": true
    },
    "input": {
      "type": "object",
      "required": ["source"],
      "properties": {
        "source": {"enum": ["repo", "diff"]},
        "diff_mode": {"enum": ["worktree", "staged", "all"]},
        "include_untracked": {"type": "boolean"},
        "diff_hash": {"type": "string"}
      },
      "additionalProperties": true
    },
    "commitUnit": {
      "type": "object",
      "required": ["id", "type", "scope", "summary", "body", "files", "hunks"],
      "properties": {
        "id": {"type": "string"},
        "type": {
          "enum": [
            "feat",
            "fix",
            "refactor",
            "style",
            "docs",
            "test",
            "chore",
            "build",
            "perf",
            "ci"
          ]
        },
        "scope": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$"
            },
            {"type": "null"}
          ]
        },
        "summary": {"type": "string", "minLength": 50, "maxLength": 72},
        "body": {
          "type": "array",
          "minItems": 1,
          "maxItems": 3,
          "items": {"type": "string"}
        },
        "files": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string"}
        },
        "hunks": {
          "type": "array",
          "maxItems": 0,
          "items": {"$ref": "#/$defs/hunk"}
        }
      },
      "additionalProperties": true
    },
    "hunk": {
      "type": "object",
      "required": ["file", "header"],
      "properties": {
        "file": {"type": "string"},
        "header": {"type": "string"},
        "id": {"type": "string"}
      },
      "additionalProperties": true
    }
  }
}
